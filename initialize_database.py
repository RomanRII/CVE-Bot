import sys
import sqlite3
from os import mkdir
from os.path import exists

db_folder = "CVE_DB/"
cve_db = f"{db_folder}cves.db"

def database_folder():
    match exists(db_folder):
        case True:
            print(f'[!] Folder: "{db_folder}" FOUND')
            sys.exit(1)
        case False:
            print(f'[+] Folder: "{db_folder}" NOT FOUND')
            mkdir(db_folder)
            print(f'[+] Folder: "{db_folder}" CREATED')

def create_database():
    match exists(cve_db):
        case True:
            print(f'[!] DATABASE: "{cve_db}" FOUND')
            sys.exit(1)
        case False:
            print(f'[+] DATABASE: "{cve_db}" NOT FOUND')
            open(cve_db, "x")
            print(f'[+] DATABASE: "{cve_db}" CREATED')

def create_cve_table():
    connection = sqlite3.connect(cve_db)
    cursor = connection.cursor()
    cve_table = """
        CREATE TABLE IF NOT EXISTS CVEs(
	    "id"	            INTEGER NOT NULL UNIQUE,
	    "cve_id"	        TEXT NOT NULL UNIQUE,
        "cwe"               TEXT,
	    "cvss_v2"           TEXT,
	    "cvss_v3"	        TEXT,
        "summary"           TEXT,
	    "vendors"   	    TEXT,
        "vendors_products"  TEXT,
	    PRIMARY KEY("id" AUTOINCREMENT)
        );"""
    cursor.execute(cve_table)
    connection.commit()
    connection.close()
    print("[+] CVE table created")

if __name__ == "__main__":
    database_folder()
    create_database()
    create_cve_table()